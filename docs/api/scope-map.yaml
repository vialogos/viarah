version: 1
operations:
  identity__auth_login_post:
    principals:
      - type: public
    notes: Creates a session cookie for subsequent session-authenticated calls.
  identity__auth_logout_post:
    principals:
      - type: session
        roles: [ADMIN, PM, MEMBER, CLIENT]
    notes: Logs out the current session (safe to call even if not logged in).
  identity__me_get:
    principals:
      - type: public
      - type: session
        roles: [ADMIN, PM, MEMBER, CLIENT]
      - type: api_key
        scopes: [read]
    notes: API-key principals require read scope; anonymous sessions return user=null.
  identity__invites_accept_post:
    principals:
      - type: public
      - type: session
        roles: [ADMIN, PM, MEMBER, CLIENT]
    notes: Accepts invite token; may create a user, Person, and membership; links Person â†” User; logs in to a session.
  identity__orgs_get:
    principals:
      - type: session
        roles: [ADMIN, PM, MEMBER, CLIENT]
    notes: Session-only; lists orgs for the current user (via memberships).
  identity__orgs_post:
    principals:
      - type: session
        roles: [ADMIN, PM, MEMBER, CLIENT]
    notes: Session-only; creates an org (client-only users are forbidden).
  identity__org_get:
    principals:
      - type: session
        roles: [ADMIN, PM, MEMBER, CLIENT]
    notes: Session-only; requires membership in the org.
  identity__org_patch:
    principals:
      - type: session
        roles: [ADMIN, PM]
    notes: Session-only; requires Admin/PM membership in the org.
  identity__org_delete:
    principals:
      - type: session
        roles: [ADMIN]
    notes: Session-only; requires Admin membership in the org.
  identity__org_logo_post:
    principals:
      - type: session
        roles: [ADMIN, PM]
    notes: Session-only; uploads org logo (image only).
  identity__org_logo_delete:
    principals:
      - type: session
        roles: [ADMIN, PM]
    notes: Session-only; clears org logo.
  identity__settings_defaults_get:
    principals:
      - type: session
        roles: [ADMIN, PM]
    notes: Session-only; gets instance-wide defaults.
  identity__settings_defaults_patch:
    principals:
      - type: session
        roles: [ADMIN, PM]
    notes: Session-only; updates instance-wide defaults.
  identity__org_defaults_get:
    principals:
      - type: session
        roles: [ADMIN, PM]
    notes: Session-only; gets org-level overrides for defaults.
  identity__org_defaults_patch:
    principals:
      - type: session
        roles: [ADMIN, PM]
    notes: Session-only; updates org-level overrides for defaults.
  identity__org_clients_get:
    principals:
      - type: session
        roles: [ADMIN, PM]
    notes: Session-only; lists clients for an org.
  identity__org_clients_post:
    principals:
      - type: session
        roles: [ADMIN, PM]
    notes: Session-only; creates a client for an org.
  identity__org_client_get:
    principals:
      - type: session
        roles: [ADMIN, PM]
    notes: Session-only; gets a client.
  identity__org_client_patch:
    principals:
      - type: session
        roles: [ADMIN, PM]
    notes: Session-only; updates a client.
  identity__org_client_delete:
    principals:
      - type: session
        roles: [ADMIN, PM]
    notes: Session-only; deletes a client.
  identity__org_person_avatar_post:
    principals:
      - type: session
        roles: [ADMIN, PM]
    notes: Session-only; uploads a Person avatar.
  identity__org_person_avatar_delete:
    principals:
      - type: session
        roles: [ADMIN, PM]
    notes: Session-only; clears a Person avatar.
  identity__org_invites_post:
    principals:
      - type: session
        roles: [ADMIN, PM]
    notes: Session-only; requires Admin/PM membership in the org.
  identity__org_invites_get:
    principals:
      - type: session
        roles: [ADMIN, PM]
    notes: Session-only; lists org invites for Admin/PM.
  identity__org_invite_revoke_post:
    principals:
      - type: session
        roles: [ADMIN, PM]
    notes: Session-only; revokes an invite (idempotent).
  identity__org_invite_resend_post:
    principals:
      - type: session
        roles: [ADMIN, PM]
    notes: Session-only; resends/regenerates an invite link (mints a new invite + token).
  identity__org_people_get:
    principals:
      - type: session
        roles: [ADMIN, PM]
    notes: Session-only; lists People records for an org (pre-invite profiles).
  identity__org_people_post:
    principals:
      - type: session
        roles: [ADMIN, PM]
    notes: Session-only; creates a Person record (pre-invite profile).
  identity__org_person_get:
    principals:
      - type: session
        roles: [ADMIN, PM]
    notes: Session-only; fetches a Person record.
  identity__org_person_patch:
    principals:
      - type: session
        roles: [ADMIN, PM]
    notes: Session-only; updates a Person record.
  identity__org_person_project_memberships_get:
    principals:
      - type: session
        roles: [ADMIN, PM]
    notes: Session-only; lists project memberships for a Person (active members only).
  identity__org_person_invite_post:
    principals:
      - type: session
        roles: [ADMIN, PM]
    notes: Session-only; creates an org invite linked to a Person record.
  identity__org_person_me_get:
    principals:
      - type: session
        roles: [ADMIN, PM, MEMBER, CLIENT]
    notes: Session-only; fetches the current user's Person record for an org.
  identity__org_person_me_patch:
    principals:
      - type: session
        roles: [ADMIN, PM, MEMBER, CLIENT]
    notes: Session-only; updates the current user's Person record for an org (safe self-service subset).
  identity__org_person_contact_entries_get:
    principals:
      - type: session
        roles: [ADMIN, PM]
    notes: Session-only; lists Person contact log entries for Admin/PM.
  identity__org_person_contact_entries_post:
    principals:
      - type: session
        roles: [ADMIN, PM]
    notes: Session-only; creates a Person contact log entry for Admin/PM.
  identity__org_person_contact_entry_patch:
    principals:
      - type: session
        roles: [ADMIN, PM]
    notes: Session-only; updates a Person contact log entry for Admin/PM.
  identity__org_person_contact_entry_delete:
    principals:
      - type: session
        roles: [ADMIN, PM]
    notes: Session-only; deletes a Person contact log entry for Admin/PM.
  identity__org_person_message_threads_get:
    principals:
      - type: session
        roles: [ADMIN, PM]
    notes: Session-only; lists Person message threads for Admin/PM.
  identity__org_person_message_threads_post:
    principals:
      - type: session
        roles: [ADMIN, PM]
    notes: Session-only; creates a Person message thread for Admin/PM.
  identity__org_person_message_thread_patch:
    principals:
      - type: session
        roles: [ADMIN, PM]
    notes: Session-only; updates a Person message thread for Admin/PM.
  identity__org_person_message_thread_delete:
    principals:
      - type: session
        roles: [ADMIN, PM]
    notes: Session-only; deletes a Person message thread for Admin/PM.
  identity__org_person_message_thread_messages_get:
    principals:
      - type: session
        roles: [ADMIN, PM]
    notes: Session-only; lists messages in a Person thread for Admin/PM.
  identity__org_person_message_thread_messages_post:
    principals:
      - type: session
        roles: [ADMIN, PM]
    notes: Session-only; creates a message in a Person thread for Admin/PM (markdown is sanitized to safe HTML).
  identity__org_person_rates_get:
    principals:
      - type: session
        roles: [ADMIN, PM]
    notes: Session-only; lists Person rate history records for Admin/PM.
  identity__org_person_rates_post:
    principals:
      - type: session
        roles: [ADMIN, PM]
    notes: Session-only; creates a Person rate record for Admin/PM.
  identity__org_person_rate_patch:
    principals:
      - type: session
        roles: [ADMIN, PM]
    notes: Session-only; updates a Person rate record for Admin/PM.
  identity__org_person_rate_delete:
    principals:
      - type: session
        roles: [ADMIN, PM]
    notes: Session-only; deletes a Person rate record for Admin/PM.
  identity__org_person_payments_get:
    principals:
      - type: session
        roles: [ADMIN, PM]
    notes: Session-only; lists Person payments ledger entries for Admin/PM.
  identity__org_person_payments_post:
    principals:
      - type: session
        roles: [ADMIN, PM]
    notes: Session-only; creates a Person payment ledger entry for Admin/PM.
  identity__org_person_payment_patch:
    principals:
      - type: session
        roles: [ADMIN, PM]
    notes: Session-only; updates a Person payment ledger entry for Admin/PM.
  identity__org_person_payment_delete:
    principals:
      - type: session
        roles: [ADMIN, PM]
    notes: Session-only; deletes a Person payment ledger entry for Admin/PM.
  identity__org_people_availability_search_get:
    principals:
      - type: session
        roles: [ADMIN, PM]
    notes: Session-only; searches People availability within a time range.
  identity__org_person_availability_get:
    principals:
      - type: session
        roles: [ADMIN, PM, MEMBER, CLIENT]
    notes: Session-only; Admin/PM can read any Person schedule; other roles can read self only.
  identity__org_person_availability_weekly_windows_post:
    principals:
      - type: session
        roles: [ADMIN, PM, MEMBER, CLIENT]
    notes: Session-only; Admin/PM can mutate any Person schedule; other roles can mutate self only.
  identity__org_person_availability_weekly_window_patch:
    principals:
      - type: session
        roles: [ADMIN, PM, MEMBER, CLIENT]
    notes: Session-only; Admin/PM can mutate any Person schedule; other roles can mutate self only.
  identity__org_person_availability_weekly_window_delete:
    principals:
      - type: session
        roles: [ADMIN, PM, MEMBER, CLIENT]
    notes: Session-only; Admin/PM can mutate any Person schedule; other roles can mutate self only.
  identity__org_person_availability_exceptions_post:
    principals:
      - type: session
        roles: [ADMIN, PM, MEMBER, CLIENT]
    notes: Session-only; Admin/PM can mutate any Person schedule; other roles can mutate self only.
  identity__org_person_availability_exception_patch:
    principals:
      - type: session
        roles: [ADMIN, PM, MEMBER, CLIENT]
    notes: Session-only; Admin/PM can mutate any Person schedule; other roles can mutate self only.
  identity__org_person_availability_exception_delete:
    principals:
      - type: session
        roles: [ADMIN, PM, MEMBER, CLIENT]
    notes: Session-only; Admin/PM can mutate any Person schedule; other roles can mutate self only.

  identity__org_memberships_get:
    principals:
      - type: session
        roles: [ADMIN, PM]
    notes: Session-only; lists org memberships for Admin/PM.
  identity__org_memberships_post:
    principals:
      - type: session
        roles: [ADMIN, PM]
    notes: Session-only; creates an org membership for an existing user (use invites for new users).
  identity__org_membership_patch:
    principals:
      - type: session
        roles: [ADMIN, PM]
    notes: Session-only; requires Admin/PM membership in the org.

  audit__org_audit_events_get:
    principals:
      - type: session
        roles: [ADMIN, PM]
    notes: Session-only; requires Admin/PM membership in the org.

  api_keys__api_keys_get:
    principals:
      - type: session
        roles: [ADMIN, PM, MEMBER]
    notes: Session-only; members can list their own keys; Admin/PM can manage org-wide keys.
  api_keys__api_keys_post:
    principals:
      - type: session
        roles: [ADMIN, PM, MEMBER]
    notes: Session-only; members can create keys for themselves; Admin/PM may specify owner_user_id.
  api_keys__api_key_revoke_post:
    principals:
      - type: session
        roles: [ADMIN, PM, MEMBER]
    notes: Session-only; members can revoke their own keys; Admin/PM can revoke any org key.
  api_keys__api_key_rotate_post:
    principals:
      - type: session
        roles: [ADMIN, PM, MEMBER]
    notes: Session-only; members can rotate their own keys; Admin/PM can rotate any org key.

  workflows__workflows_get:
    principals:
      - type: session
        roles: [ADMIN, PM, MEMBER, CLIENT]
      - type: api_key
        scopes: [read]
    notes: API keys must match org_id; write implies read.
  workflows__workflows_post:
    principals:
      - type: session
        roles: [ADMIN, PM]
      - type: api_key
        scopes: [write]
    notes: API keys must match org_id; requires write scope.
  workflows__workflow_get:
    principals:
      - type: session
        roles: [ADMIN, PM, MEMBER, CLIENT]
      - type: api_key
        scopes: [read]
  workflows__workflow_patch:
    principals:
      - type: session
        roles: [ADMIN, PM]
      - type: api_key
        scopes: [write]
  workflows__workflow_delete:
    principals:
      - type: session
        roles: [ADMIN, PM]
      - type: api_key
        scopes: [write]
  workflows__workflow_stages_get:
    principals:
      - type: session
        roles: [ADMIN, PM, MEMBER, CLIENT]
      - type: api_key
        scopes: [read]
  workflows__workflow_stages_post:
    principals:
      - type: session
        roles: [ADMIN, PM]
      - type: api_key
        scopes: [write]
  workflows__workflow_stage_get:
    principals:
      - type: session
        roles: [ADMIN, PM, MEMBER, CLIENT]
      - type: api_key
        scopes: [read]
  workflows__workflow_stage_patch:
    principals:
      - type: session
        roles: [ADMIN, PM]
      - type: api_key
        scopes: [write]
  workflows__workflow_stage_delete:
    principals:
      - type: session
        roles: [ADMIN, PM]
      - type: api_key
        scopes: [write]

  work_items__projects_get:
    principals:
      - type: session
        roles: [ADMIN, PM, MEMBER, CLIENT]
      - type: api_key
        scopes: [read]
    notes: API keys may be project-restricted; session clients only see projects they can access (client-safe projection).
  work_items__projects_post:
    principals:
      - type: session
        roles: [ADMIN, PM, MEMBER]
      - type: api_key
        scopes: [write]
    notes: Project-restricted API keys cannot create new projects.
  work_items__project_get:
    principals:
      - type: session
        roles: [ADMIN, PM, MEMBER, CLIENT]
      - type: api_key
        scopes: [read]
    notes: API keys may be project-restricted; session clients only see projects they can access (client-safe projection).
  work_items__project_patch:
    principals:
      - type: session
        roles: [ADMIN, PM, MEMBER]
      - type: api_key
        scopes: [write]
    notes: API keys may be project-restricted to a single project.
  work_items__project_delete:
    principals:
      - type: session
        roles: [ADMIN, PM, MEMBER]
      - type: api_key
        scopes: [write]
    notes: API keys may be project-restricted to a single project.
  work_items__project_memberships_get:
    principals:
      - type: session
        roles: [ADMIN, PM]
    notes: Session-only; API keys cannot manage project memberships.
  work_items__project_memberships_post:
    principals:
      - type: session
        roles: [ADMIN, PM]
    notes: Session-only; adds a user to a project for access/assignment scoping.
  work_items__project_membership_delete:
    principals:
      - type: session
        roles: [ADMIN, PM]
    notes: Session-only; removes a user from a project.
  work_items__project_epics_get:
    principals:
      - type: session
        roles: [ADMIN, PM, MEMBER]
      - type: api_key
        scopes: [read]
    notes: API keys may be project-restricted.
  work_items__project_epics_post:
    principals:
      - type: session
        roles: [ADMIN, PM, MEMBER]
      - type: api_key
        scopes: [write]
    notes: API keys may be project-restricted.
  work_items__epic_get:
    principals:
      - type: session
        roles: [ADMIN, PM, MEMBER]
      - type: api_key
        scopes: [read]
  work_items__epic_patch:
    principals:
      - type: session
        roles: [ADMIN, PM, MEMBER]
      - type: api_key
        scopes: [write]
  work_items__epic_delete:
    principals:
      - type: session
        roles: [ADMIN, PM, MEMBER]
      - type: api_key
        scopes: [write]
  work_items__epic_tasks_post:
    principals:
      - type: session
        roles: [ADMIN, PM, MEMBER]
      - type: api_key
        scopes: [write]
  work_items__project_tasks_get:
    principals:
      - type: session
        roles: [ADMIN, PM, MEMBER, CLIENT]
      - type: api_key
        scopes: [read]
    notes: Session clients only see tasks for projects they can access, and only client-safe tasks/subtasks.
  work_items__task_resolve_context_get:
    principals:
      - type: session
        roles: [ADMIN, PM, MEMBER, CLIENT]
    notes: Session-only; resolves org/project context for task deep links (API keys are forbidden). Session clients only resolve client-safe tasks.
  work_items__task_get:
    principals:
      - type: session
        roles: [ADMIN, PM, MEMBER, CLIENT]
      - type: api_key
        scopes: [read]
    notes: Session clients only see tasks for projects they can access, and only client-safe tasks.
  work_items__task_patch:
    principals:
      - type: session
        roles: [ADMIN, PM, MEMBER]
      - type: api_key
        scopes: [write]
  work_items__task_delete:
    principals:
      - type: session
        roles: [ADMIN, PM, MEMBER]
      - type: api_key
        scopes: [write]
  work_items__task_sow_get:
    principals:
      - type: session
        roles: [ADMIN, PM, MEMBER, CLIENT]
      - type: api_key
        scopes: [read]
    notes: Session clients only see task SoW metadata/download for projects they can access, and only for client-safe tasks.
  work_items__task_sow_post:
    principals:
      - type: session
        roles: [ADMIN, PM, MEMBER]
      - type: api_key
        scopes: [write]
  work_items__task_sow_delete:
    principals:
      - type: session
        roles: [ADMIN, PM, MEMBER]
      - type: api_key
        scopes: [write]
  work_items__task_sow_download_get:
    principals:
      - type: session
        roles: [ADMIN, PM, MEMBER, CLIENT]
      - type: api_key
        scopes: [read]
    notes: Session clients only see task SoW metadata/download for projects they can access, and only for client-safe tasks.
  work_items__task_participants_get:
    principals:
      - type: session
        roles: [ADMIN, PM, MEMBER, CLIENT]
      - type: api_key
        scopes: [read]
    notes: Includes manual participants plus auto participants from assignee/comments/GitLab mapping.
  work_items__task_participants_post:
    principals:
      - type: session
        roles: [ADMIN, PM]
    notes: Session-only; adds a manual participant (must be an org member and, for MEMBER/CLIENT, a project member).
  work_items__task_participant_delete:
    principals:
      - type: session
        roles: [ADMIN, PM]
    notes: Session-only; removes a manual participant.
  work_items__task_subtasks_get:
    principals:
      - type: session
        roles: [ADMIN, PM, MEMBER, CLIENT]
      - type: api_key
        scopes: [read]
    notes: Session clients only see client-safe subtasks (when enforced by parent task safety).
  work_items__task_subtasks_post:
    principals:
      - type: session
        roles: [ADMIN, PM, MEMBER]
      - type: api_key
        scopes: [write]
  work_items__subtask_get:
    principals:
      - type: session
        roles: [ADMIN, PM, MEMBER, CLIENT]
      - type: api_key
        scopes: [read]
  work_items__subtask_patch:
    principals:
      - type: session
        roles: [ADMIN, PM, MEMBER]
      - type: api_key
        scopes: [write]
  work_items__subtask_delete:
    principals:
      - type: session
        roles: [ADMIN, PM, MEMBER]
      - type: api_key
        scopes: [write]

  notifications__my_notifications_get:
    principals:
      - type: session
        roles: [ADMIN, PM, MEMBER, CLIENT]
    notes: Session-only; scoped to the current user.
  notifications__my_notifications_badge_get:
    principals:
      - type: session
        roles: [ADMIN, PM, MEMBER, CLIENT]
    notes: Session-only; scoped to the current user.
  notifications__my_notifications_mark_all_read_post:
    principals:
      - type: session
        roles: [ADMIN, PM, MEMBER, CLIENT]
    notes: Session-only; scoped to the current user.
  notifications__my_notification_patch:
    principals:
      - type: session
        roles: [ADMIN, PM, MEMBER, CLIENT]
    notes: Session-only; scoped to the current user.
  notifications__notification_preferences_get:
    principals:
      - type: session
        roles: [ADMIN, PM, MEMBER, CLIENT]
    notes: Session-only; scoped to the current user.
  notifications__notification_preferences_patch:
    principals:
      - type: session
        roles: [ADMIN, PM, MEMBER, CLIENT]
    notes: Session-only; scoped to the current user.
  notifications__notification_settings_get:
    principals:
      - type: session
        roles: [ADMIN, PM]
    notes: Session-only; project-level Admin/PM.
  notifications__notification_settings_patch:
    principals:
      - type: session
        roles: [ADMIN, PM]
    notes: Session-only; project-level Admin/PM.
  notifications__notification_delivery_logs_get:
    principals:
      - type: session
        roles: [ADMIN, PM]
    notes: Session-only; project-level Admin/PM.
  notifications__notification_events_get:
    principals:
      - type: session
        roles: [ADMIN, PM]
      - type: api_key
        scopes: [read]
    notes: Returns client-safe payload (IDs + event_type + timestamps only).

  push__vapid_public_key_get:
    principals:
      - type: session
        roles: [ADMIN, PM, MEMBER, CLIENT]
    notes: Session-only; returns the VAPID public key for web push.
  push__vapid_config_get:
    principals:
      - type: session
        roles: [ADMIN, PM]
    notes: Session-only; reads VAPID config status (never includes private key).
  push__vapid_config_patch:
    principals:
      - type: session
        roles: [ADMIN, PM]
    notes: Session-only; sets VAPID config (private key is write-only).
  push__vapid_config_delete:
    principals:
      - type: session
        roles: [ADMIN, PM]
    notes: Session-only; clears DB-backed VAPID config.
  push__vapid_config_generate_post:
    principals:
      - type: session
        roles: [ADMIN, PM]
    notes: Session-only; generates and stores a new VAPID keypair.
  push__subscriptions_get:
    principals:
      - type: session
        roles: [ADMIN, PM, MEMBER, CLIENT]
    notes: Session-only; scoped to the current user.
  push__subscriptions_post:
    principals:
      - type: session
        roles: [ADMIN, PM, MEMBER, CLIENT]
    notes: Session-only; upserts a subscription for the current user.
  push__subscription_delete:
    principals:
      - type: session
        roles: [ADMIN, PM, MEMBER, CLIENT]
    notes: Session-only; deletes a subscription for the current user.

  sows__sows_get:
    principals:
      - type: session
        roles: [ADMIN, PM, CLIENT]
    notes: Session-only; clients only see SoWs where they are assigned signers (members are forbidden).
  sows__sows_post:
    principals:
      - type: session
        roles: [ADMIN, PM]
    notes: Session-only; creates a SoW and initial version.
  sows__sow_get:
    principals:
      - type: session
        roles: [ADMIN, PM, CLIENT]
    notes: Session-only; clients must be signers on the current version (members are forbidden).
  sows__sow_send_post:
    principals:
      - type: session
        roles: [ADMIN, PM]
    notes: Session-only; moves the current version to pending signature.
  sows__sow_respond_post:
    principals:
      - type: session
        roles: [CLIENT]
    notes: Session-only; signer must be a client org member and a signer on the current version.
  sows__sow_versions_post:
    principals:
      - type: session
        roles: [ADMIN, PM]
    notes: Session-only; creates a new version (blocked while signature is pending).
  sows__sow_pdf_get:
    principals:
      - type: session
        roles: [ADMIN, PM, CLIENT]
    notes: Session-only; requires signed SoW and PDF artifact ready; clients must be signers.
  sows__sow_pdf_post:
    principals:
      - type: session
        roles: [ADMIN, PM]
    notes: Session-only; enqueues PDF render for a signed SoW.

  templates__templates_get:
    principals:
      - type: session
        roles: [ADMIN, PM, MEMBER]
      - type: api_key
        scopes: [read]
  templates__templates_post:
    principals:
      - type: session
        roles: [ADMIN, PM]
      - type: api_key
        scopes: [write]
  templates__template_get:
    principals:
      - type: session
        roles: [ADMIN, PM, MEMBER]
      - type: api_key
        scopes: [read]
  templates__template_versions_post:
    principals:
      - type: session
        roles: [ADMIN, PM]
      - type: api_key
        scopes: [write]
  templates__template_version_get:
    principals:
      - type: session
        roles: [ADMIN, PM, MEMBER]
      - type: api_key
        scopes: [read]

  reports__report_runs_get:
    principals:
      - type: session
        roles: [ADMIN, PM, MEMBER]
      - type: api_key
        scopes: [read]
    notes: API keys may be project-restricted.
  reports__report_runs_post:
    principals:
      - type: session
        roles: [ADMIN, PM]
      - type: api_key
        scopes: [write]
    notes: API keys may be project-restricted.
  reports__report_run_get:
    principals:
      - type: session
        roles: [ADMIN, PM, MEMBER]
      - type: api_key
        scopes: [read]
  reports__report_run_regenerate_post:
    principals:
      - type: session
        roles: [ADMIN, PM]
      - type: api_key
        scopes: [write]
  reports__report_run_web_view_get:
    principals:
      - type: session
        roles: [ADMIN, PM, MEMBER]
      - type: api_key
        scopes: [read]
  reports__report_run_pdf_get:
    principals:
      - type: session
        roles: [ADMIN, PM, MEMBER]
      - type: api_key
        scopes: [read]
  reports__report_run_pdf_post:
    principals:
      - type: session
        roles: [ADMIN, PM]
      - type: api_key
        scopes: [write]
  reports__report_run_render_logs_get:
    principals:
      - type: session
        roles: [ADMIN, PM]
      - type: api_key
        scopes: [read]

  share_links__report_run_publish_post:
    principals:
      - type: session
        roles: [ADMIN, PM]
      - type: api_key
        scopes: [write]
    notes: API keys may be project-restricted.
  share_links__share_links_get:
    principals:
      - type: session
        roles: [ADMIN, PM]
      - type: api_key
        scopes: [read]
    notes: API keys may be project-restricted.
  share_links__share_link_revoke_post:
    principals:
      - type: session
        roles: [ADMIN, PM]
      - type: api_key
        scopes: [write]
    notes: API keys may be project-restricted.
  share_links__share_link_access_logs_get:
    principals:
      - type: session
        roles: [ADMIN, PM]
      - type: api_key
        scopes: [read]
    notes: API keys may be project-restricted.

  collaboration__task_comments_get:
    principals:
      - type: session
        roles: [ADMIN, PM, MEMBER, CLIENT]
      - type: api_key
        scopes: [read]
    notes: API keys may be project-restricted; client membership is limited to client-safe work items.
  collaboration__task_comments_post:
    principals:
      - type: session
        roles: [ADMIN, PM, MEMBER, CLIENT]
      - type: api_key
        scopes: [write]
    notes: API keys may be project-restricted; client membership may only create client-safe comments.
  collaboration__epic_comments_get:
    principals:
      - type: session
        roles: [ADMIN, PM, MEMBER]
      - type: api_key
        scopes: [read]
    notes: API keys may be project-restricted.
  collaboration__epic_comments_post:
    principals:
      - type: session
        roles: [ADMIN, PM, MEMBER]
      - type: api_key
        scopes: [write]
    notes: API keys may be project-restricted.
  collaboration__task_attachments_get:
    principals:
      - type: session
        roles: [ADMIN, PM, MEMBER]
      - type: api_key
        scopes: [read]
    notes: Session-only.
  collaboration__task_attachments_post:
    principals:
      - type: session
        roles: [ADMIN, PM, MEMBER]
      - type: api_key
        scopes: [write]
    notes: Session-only.
  collaboration__epic_attachments_get:
    principals:
      - type: session
        roles: [ADMIN, PM, MEMBER]
      - type: api_key
        scopes: [read]
    notes: Session-only.
  collaboration__epic_attachments_post:
    principals:
      - type: session
        roles: [ADMIN, PM, MEMBER]
      - type: api_key
        scopes: [write]
    notes: Session-only.
  collaboration__attachment_download_get:
    principals:
      - type: session
        roles: [ADMIN, PM, MEMBER]
    notes: Session-only.

  outbound_comms__outbound_drafts_get:
    principals:
      - type: session
        roles: [ADMIN, PM]
    notes: Session-only.
  outbound_comms__outbound_drafts_post:
    principals:
      - type: session
        roles: [ADMIN, PM]
    notes: Session-only.
  outbound_comms__outbound_draft_get:
    principals:
      - type: session
        roles: [ADMIN, PM]
    notes: Session-only.
  outbound_comms__outbound_draft_patch:
    principals:
      - type: session
        roles: [ADMIN, PM]
    notes: Session-only.
  outbound_comms__outbound_draft_send_post:
    principals:
      - type: session
        roles: [ADMIN, PM]
    notes: Session-only.

  customization__saved_views_get:
    principals:
      - type: session
        roles: [ADMIN, PM, MEMBER, CLIENT]
    notes: Session-only; returns only caller-owned views; clients only see client_safe.
  customization__saved_views_post:
    principals:
      - type: session
        roles: [ADMIN, PM]
    notes: Session-only; requires Admin/PM.
  customization__saved_view_patch:
    principals:
      - type: session
        roles: [ADMIN, PM]
    notes: Session-only; requires Admin/PM.
  customization__saved_view_delete:
    principals:
      - type: session
        roles: [ADMIN, PM]
    notes: Session-only; requires Admin/PM.
  customization__custom_fields_get:
    principals:
      - type: session
        roles: [ADMIN, PM, MEMBER, CLIENT]
      - type: api_key
        scopes: [read]
    notes: Session-only; clients only see client_safe fields.
  customization__custom_fields_post:
    principals:
      - type: session
        roles: [ADMIN, PM]
      - type: api_key
        scopes: [write]
    notes: Session-only; requires Admin/PM.
  customization__custom_field_patch:
    principals:
      - type: session
        roles: [ADMIN, PM]
    notes: Session-only; requires Admin/PM.
  customization__custom_field_delete:
    principals:
      - type: session
        roles: [ADMIN, PM]
    notes: Session-only; requires Admin/PM.
  customization__task_custom_field_values_patch:
    principals:
      - type: session
        roles: [ADMIN, PM]
      - type: api_key
        scopes: [write]
    notes: Session-only; requires Admin/PM.
  customization__subtask_custom_field_values_patch:
    principals:
      - type: session
        roles: [ADMIN, PM]
      - type: api_key
        scopes: [write]
    notes: Session-only; requires Admin/PM.

  integrations__gitlab_integration_get:
    principals:
      - type: session
        roles: [ADMIN, PM]
    notes: Session-only; requires Admin/PM.
  integrations__gitlab_integration_patch:
    principals:
      - type: session
        roles: [ADMIN, PM]
    notes: Session-only; requires Admin/PM.
  integrations__gitlab_integration_delete:
    principals:
      - type: session
        roles: [ADMIN, PM]
    notes: Session-only; deletes org-level GitLab integration override.
  integrations__settings_gitlab_integration_get:
    principals:
      - type: session
        roles: [ADMIN, PM]
    notes: Session-only; gets instance-wide GitLab integration defaults.
  integrations__settings_gitlab_integration_patch:
    principals:
      - type: session
        roles: [ADMIN, PM]
    notes: Session-only; updates instance-wide GitLab integration defaults.
  integrations__gitlab_integration_validate_post:
    principals:
      - type: session
        roles: [ADMIN, PM]
    notes: Session-only; requires Admin/PM.
  integrations__task_gitlab_links_get:
    principals:
      - type: session
        roles: [ADMIN, PM, MEMBER]
      - type: api_key
        scopes: [read]
    notes: Session or API key (read).
  integrations__task_gitlab_links_post:
    principals:
      - type: session
        roles: [ADMIN, PM, MEMBER]
      - type: api_key
        scopes: [write]
    notes: Session or API key (write).
  integrations__task_gitlab_link_delete:
    principals:
      - type: session
        roles: [ADMIN, PM, MEMBER]
      - type: api_key
        scopes: [write]
    notes: Session or API key (write).
  integrations__gitlab_webhook_post:
    principals:
      - type: gitlab_webhook
        auth: X-Gitlab-Token
    notes: Webhook secret header required; session/API keys not used.
